<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>CoffeeScript WebGL ARP Signing Avatar: vhg.2024</title>

<meta http-equiv="Access-Control-Allow-Origin" content="*">
<meta http-equiv="Access-Control-Allow-Methods" content="GET">

<!-- CWA @ vhg.cmp.uea.ac.uk/jrwg/ -->
<link rel="stylesheet"
    href="https://vhg.cmp.uea.ac.uk/tech/jas/vhg2024/cwa/cwasa.css" />
<script type="text/javascript"
    src="https://vhg.cmp.uea.ac.uk/tech/jas/vhg2024/cwa/allcsa.js"></script>

<style>
  @font-face {
    font-family: 'HamNoSys';
    src: url('https://vhg.cmp.uea.ac.uk/tech/hamnosys/HamNoSysUnicode.ttf') format('truetype');
  }

  #myHamNoSys {
    font-family: 'HamNoSys', monospace;
    font-size: 2.5em;
    line-height: 1.2;
    width: 80%;
  }

  #sigmlOutput {
    width: 80%;
    height: 15em;
    margin-top: 1em;
  }
</style>

<script language="javascript">

// CWASA.getLogger("Avatar", "info");
// CWASA.getLogger("Avatar", "debug");
//CWASA.getLogger("Avatar", "trace");
CWASA.getLogger("AGI", "debug");
CWASA.getLogger("Queue", "debug");

function playText(stext) {
	CWASA.playSiGMLText(stext);
}

// New function to handle HamNoSys input
function playHamNoSys() {
    const hamnosysString = document.getElementById("myHamNoSys").value;
    const sigmlText = hamNoSysToSiGML(hamnosysString);
    playText(sigmlText);
    document.getElementById("sigmlOutput").value = sigmlText;
}

/**
 * Converts HamNoSys Unicode characters to SiGML XML.
 * This is a direct translation of the HamNoSys2SiGML.py script.
 */
function hamNoSysToSiGML(hamnosysString) {
  // Combined conversion table mapping HamNoSys Unicode (4-digit hex) to SiGML tags.
  // This data is sourced from the conversionSpreadSheet.txt file and common HamNoSys font encodings.
  const hamnosysConversionMap = {
    "0020": "hamspace",
    "0021": "hamexclaim",
    "002C": "hamcomma",
    "002E": "hamfullstop",
    "003F": "hamquery",
    "007B": "hamaltbegin",
    "007C": "hammetaalt",
    "007D": "hamaltend",
    "E000": "hamfist",
    "E001": "hamflathand",
    "E002": "hamfinger2",
    "E003": "hamfinger23",
    "E004": "hamfinger23spread",
    "E005": "hamfinger2345",
    "E006": "hampinch12",
    "E007": "hampinchall",
    "E008": "hampinch12open",
    "E009": "hamcee12",
    "E00A": "hamceeall",
    "E00B": "hamceeopen",
    "E00C": "hamthumboutmod",
    "E00D": "hamthumbacrossmod",
    "E00E": "hamthumbopenmod",
    "E010": "hamfingerstraightmod",
    "E011": "hamfingerbendmod",
    "E012": "hamfingerhookmod",
    "E013": "hamdoublebent",
    "E014": "hamdoublehooked",
    "E020": "hamextfingeru",
    "E021": "hamextfingerur",
    "E022": "hamextfingerr",
    "E023": "hamextfingerdr",
    "E024": "hamextfingerd",
    "E025": "hamextfingerdl",
    "E026": "hamextfingerl",
    "E027": "hamextfingerul",
    "E028": "hamextfingerol",
    "E029": "hamextfingero",
    "E02A": "hamextfingeror",
    "E02B": "hamextfingeril",
    "E02C": "hamextfingeri",
    "E02D": "hamextfingerir",
    "E02E": "hamextfingerui",
    "E02F": "hamextfingerdi",
    "E030": "hamextfingerdo",
    "E031": "hamextfingeruo",
    "E038": "hampalmu",
    "E039": "hampalmur",
    "E03A": "hampalmr",
    "E03B": "hampalmdr",
    "E03C": "hampalmd",
    "E03D": "hampalmdl",
    "E03E": "hampalml",
    "E03F": "hampalmul",
    "E040": "hamhead",
    "E041": "hamheadtop",
    "E042": "hamforehead",
    "E043": "hameyebrows",
    "E044": "hameyes",
    "E045": "hamnose",
    "E046": "hamnostrils",
    "E047": "hamear",
    "E048": "hamearlobe",
    "E049": "hamcheek",
    "E04A": "hamlips",
    "E04B": "hamtongue",
    "E04C": "hamteeth",
    "E04D": "hamchin",
    "E04E": "hamunderchin",
    "E04F": "hamneck",
    "E050": "hamshouldertop",
    "E051": "hamshoulders",
    "E052": "hamchest",
    "E053": "hamstomach",
    "E054": "hambelowstomach",
    "00EE": "hambelowstomach",
    "E058": "hamlrbeside",
    "00EF": "hamlrbeside",
    "E059": "hamlrat",
    "E05A": "hamcoreftag",
    "E05B": "hamcorefref",
    "E05F": "hamneutralspace",
    "E060": "hamupperarm",
    "E061": "hamelbow",
    "E062": "hamelbowinside",
    "E063": "hamlowerarm",
    "E064": "hamwristback",
    "E065": "hamwristpulse",
    "E066": "hamthumbball",
    "E067": "hampalm",
    "E068": "hamhandback",
    "E069": "hamthumbside",
    "E06A": "hampinkyside",
    "E070": "hamthumb",
    "E071": "hamindexfinger",
    "E072": "hammiddlefinger",
    "E073": "hamringfinger",
    "E074": "hampinky",
    "E075": "hamfingertip",
    "E076": "hamfingernail",
    "E077": "hamfingerpad",
    "E078": "hamfingermidjoint",
    "E079": "hamfingerbase",
    "E07A": "hamfingerside",
    "E07C": "hamwristtopulse",
    "E07D": "hamwristtoback",
    "E07E": "hamwristtothumb",
    "E07F": "hamwristtopinky",
    "E080": "hammoveu",
    "E081": "hammoveur",
    "E082": "hammover",
    "E083": "hammovedr",
    "E084": "hammoved",
    "E085": "hammovedl",
    "E086": "hammovel",
    "E087": "hammoveul",
    "E088": "hammoveol",
    "E089": "hammoveo",
    "E08A": "hammoveor",
    "E08B": "hammoveil",
    "E08C": "hammovei",
    "E08D": "hammoveir",
    "E08E": "hammoveui",
    "E08F": "hammovedi",
    "E090": "hammovedo",
    "E091": "hammoveuo",
    "E092": "hamcircleo",
    "E093": "hamcirclei",
    "E094": "hamcircled",
    "E095": "hamcircleu",
    "E096": "hamcirclel",
    "E097": "hamcircler",
    "E098": "hamcircleul",
    "E099": "hamcircledr",
    "E09A": "hamcircleur",
    "E09B": "hamcircledl",
    "E09C": "hamcircleol",
    "E09D": "hamcircleir",
    "E09E": "hamcircleor",
    "E09F": "hamcircleil",
    "E0A0": "hamcircleui",
    "E0A1": "hamcircledo",
    "E0A2": "hamcircleuo",
    "E0A3": "hamcircledi",
    "E0A4": "hamfingerplay",
    "E0A5": "hamnodding",
    "E0A6": "hamswinging",
    "E0A7": "hamtwisting",
    "E0A8": "hamstircw",
    "E0A9": "hamstirccw",
    "E0AA": "hamreplace",
    "E0AD": "hammovecross",
    "E0AE": "hammoveX",
    "E0AF": "hamnomotion",
    "E0B0": "hamclocku",
    "E0B1": "hamclockul",
    "E0B2": "hamclockl",
    "E0B3": "hamclockdl",
    "E0B4": "hamclockd",
    "E0B5": "hamclockdr",
    "E0B6": "hamclockr",
    "E0B7": "hamclockur",
    "E0B8": "hamclockfull",
    "E0B9": "hamarcl",
    "E0BA": "hamarcu",
    "E0BB": "hamarcr",
    "E0BC": "hamarcd",
    "E0BD": "hamwavy",
    "E0BE": "hamzigzag",
    "E0C0": "hamellipseh",
    "E0C1": "hamellipseur",
    "E0C2": "hamellipsev",
    "E0C3": "hamellipseul",
    "E0C4": "hamincreasing",
    "E0C5": "hamdecreasing",
    "E0C6": "hamsmallmod",
    "E0C7": "hamlargemod",
    "E0C8": "hamfast",
    "E0C9": "hamslow",
    "E0CA": "hamtense",
    "E0CB": "hamrest",
    "E0CC": "hamhalt",
    "E0D0": "hamclose",
    "E0D1": "hamtouch",
    "E0D2": "haminterlock",
    "E0D3": "hamcross",
    "E0D4": "hamarmextended",
    "E0D5": "hambehind",
    "E0D6": "hambrushing",
    "E0D8": "hamrepeatfromstart",
    "E0D9": "hamrepeatfromstartseveral",
    "E0DA": "hamrepeatcontinue",
    "E0DB": "hamrepeatcontinueseveral",
    "E0DC": "hamrepeatreverse",
    "E0DD": "hamalternatingmotion",
    "E0E0": "hamseqbegin",
    "E0E1": "hamseqend",
    "E0E2": "hamparbegin",
    "E0E3": "hamparend",
    "E0E4": "hamfusionbegin",
    "E0E5": "hamfusionend",
    "E0E6": "hambetween",
    "E0E7": "hamplus",
    "E0E8": "hamsymmpar",
    "E0E9": "hamsymmlr",
    "E0EA": "hamnondominant",
    "E0EB": "hamnonipsi",
    "E0EC": "hametc",
    "E0ED": "hamorirelative",
    "E0F0": "hammime",
    "E0F1": "hamversion40",
    // Add F-series Unicode mappings
    "F000": "hamfist",
    "F001": "hamflathand",
    "F002": "hamfinger2",
    "F003": "hamfinger23",
    "F004": "hamfinger23spread",
    "F005": "hamfinger2345",
    "F006": "hampinch12",
    "F007": "hampinchall",
    "F008": "hampinch12open",
    "F009": "hamcee12",
    "F00A": "hamceeall",
    "F00B": "hamceeopen",
    "F00C": "hamthumboutmod",
    "F00D": "hamthumbacrossmod",
    "F00E": "hamthumbopenmod",
    "F010": "hamfingerstraightmod",
    "F011": "hamfingerbendmod",
    "F012": "hamfingerhookmod",
    "F013": "hamdoublebent",
    "F014": "hamdoublehooked",
    "F020": "hamextfingeru",
    "F021": "hamextfingerur",
    "F022": "hamextfingerr",
    "F023": "hamextfingerdr",
    "F024": "hamextfingerd",
    "F025": "hamextfingerdl",
    "F026": "hamextfingerl",
    "F027": "hamextfingerul",
    "F028": "hamextfingerol",
    "F029": "hamextfingero",
    "F02A": "hamextfingeror",
    "F02B": "hamextfingeril",
    "F02C": "hamextfingeri",
    "F02D": "hamextfingerir",
    "F02E": "hamextfingerui",
    "F02F": "hamextfingerdi",
    "F030": "hamextfingerdo",
    "F031": "hammoveuo",
    "F038": "hampalmu",
    "F039": "hampalmur",
    "F03A": "hampalmr",
    "F03B": "hampalmdr",
    "F03C": "hampalmd",
    "F03D": "hampalmdl",
    "F03E": "hampalml",
    "F03F": "hampalmul",
    "F040": "hamhead",
    "F041": "hamheadtop",
    "F042": "hamforehead",
    "F043": "hameyebrows",
    "F044": "hameyes",
    "F045": "hamnose",
    "F046": "hamnostrils",
    "F047": "hamear",
    "F048": "hamearlobe",
    "F049": "hamcheek",
    "F04A": "hamlips",
    "F04B": "hamtongue",
    "F04C": "hamteeth",
    "F04D": "hamchin",
    "F04E": "hamunderchin",
    "F04F": "hamneck",
    "F050": "hamshouldertop",
    "F051": "hamshoulders",
    "F052": "hamchest",
    "F053": "hamstomach",
    "F054": "hambelowstomach",
    "F058": "hamlrbeside",
    "F059": "hamlrat",
    "F05A": "hamcoreftag",
    "F05B": "hamcorefref",
    "F05F": "hamneutralspace",
    "F060": "hamupperarm",
    "F061": "hamelbow",
    "F062": "hamelbowinside",
    "F063": "hamlowerarm",
    "F064": "hamwristback",
    "F065": "hamwristpulse",
    "F066": "hamthumbball",
    "F067": "hampalm",
    "F068": "hamhandback",
    "F069": "hamthumbside",
    "F06A": "hampinkyside",
    "F070": "hamthumb",
    "F071": "hamindexfinger",
    "F072": "hammiddlefinger",
    "F073": "hamringfinger",
    "F074": "hampinky",
    "F075": "hamfingertip",
    "F076": "hamfingernail",
    "F077": "hamfingerpad",
    "F078": "hamfingermidjoint",
    "F079": "hamfingerbase",
    "F07A": "hamfingerside",
    "F07C": "hamwristtopulse",
    "F07D": "hamwristtoback",
    "F07E": "hamwristtothumb",
    "F07F": "hamwristtopinky",
    "F080": "hammoveu",
    "F081": "hammoveur",
    "F082": "hammover",
    "F083": "hammovedr",
    "F084": "hammoved",
    "F085": "hammovedl",
    "F086": "hammovel",
    "F087": "hammoveul",
    "F088": "hammoveol",
    "F089": "hammoveo",
    "F08A": "hammoveor",
    "F08B": "hammoveil",
    "F08C": "hammovei",
    "F08D": "hammoveir",
    "F08E": "hammoveui",
    "F08F": "hammovedi",
    "F090": "hammovedo",
    "F091": "hammoveuo",
    "F092": "hamcircleo",
    "F093": "hamcirclei",
    "F094": "hamcircled",
    "F095": "hamcircleu",
    "F096": "hamcirclel",
    "F097": "hamcircler",
    "F098": "hamcircleul",
    "F099": "hamcircledr",
    "F09A": "hamcircleur",
    "F09B": "hamcircledl",
    "F09C": "hamcircleol",
    "F09D": "hamcircleir",
    "F09E": "hamcircleor",
    "F09F": "hamcircleil",
    "F0A0": "hamcircleui",
    "F0A1": "hamcircledo",
    "F0A2": "hamcircleuo",
    "F0A3": "hamcircledi",
    "F0A4": "hamfingerplay",
    "F0A5": "hamnodding",
    "F0A6": "hamswinging",
    "F0A7": "hamtwisting",
    "F0A8": "hamstircw",
    "F0A9": "hamstirccw",
    "F0AA": "hamreplace",
    "F0AD": "hammovecross",
    "F0AE": "hammoveX",
    "F0AF": "hamnomotion",
    "F0B0": "hamclocku",
    "F0B1": "hamclockul",
    "F0B2": "hamclockl",
    "F0B3": "hamclockdl",
    "F0B4": "hamclockd",
    "F0B5": "hamclockdr",
    "F0B6": "hamclockr",
    "F0B7": "hamclockur",
    "F0B8": "hamclockfull",
    "F0B9": "hamarcl",
    "F0BA": "hamarcu",
    "F0BB": "hamarcr",
    "F0BC": "hamarcd",
    "F0BD": "hamwavy",
    "F0BE": "hamzigzag",
    "F0C0": "hamellipseh",
    "F0C1": "hamellipseur",
    "F0C2": "hamellipsev",
    "F0C3": "hamellipseul",
    "F0C4": "hamincreasing",
    "F0C5": "hamdecreasing",
    "F0C6": "hamsmallmod",
    "F0C7": "hamlargemod",
    "F0C8": "hamfast",
    "F0C9": "hamslow",
    "F0CA": "hamtense",
    "F0CB": "hamrest",
    "F0CC": "hamhalt",
    "F0D0": "hamclose",
    "F0D1": "hamtouch",
    "F0D2": "haminterlock",
    "F0D3": "hamcross",
    "F0D4": "hamarmextended",
    "F0D5": "hambehind",
    "F0D6": "hambrushing",
    "F0D8": "hamrepeatfromstart",
    "F0D9": "hamrepeatfromstartseveral",
    "E0DA": "hamrepeatcontinue",
    "E0DB": "hamrepeatcontinueseveral",
    "E0DC": "hamrepeatreverse",
    "E0DD": "hamalternatingmotion",
    "E0E0": "hamseqbegin",
    "E0E1": "hamseqend",
    "E0E2": "hamparbegin",
    "E0E3": "hamparend",
    "E0E4": "hamfusionbegin",
    "E0E5": "hamfusionend",
    "E0E6": "hambetween",
    "E0E7": "hamplus",
    "E0E8": "hamsymmpar",
    "E0E9": "hamsymmlr",
    "E0EA": "hamnondominant",
    "E0EB": "hamnonipsi",
    "E0EC": "hametc",
    "E0ED": "hamorirelative",
    "E0F0": "hammime",
    "E0F1": "hamversion40",
    "F031": "hammoveuo",
    "F031": "hamextfingeruo",
  };

  const sigmlBlocks = [];
  const hamnosysWords = hamnosysString.split(' ');

  for (const word of hamnosysWords) {
    if (word.trim() === '') continue; // Skip empty words from multiple spaces
    const sigmlTags = [];
    for (let i = 0; i < word.length; i++) {
      const char = word[i];
      const codePoint = char.codePointAt(0);
      const hex = codePoint.toString(16).toUpperCase().padStart(4, '0');
      const tag = hamnosysConversionMap[hex];
      if (tag) {
        sigmlTags.push(tag);
      } else {
        console.warn(`No SiGML tag found for HamNoSys character: ${char} (Unicode: ${hex})`);
      }
    }

    const manualTags = sigmlTags.map(tag => `\t\t\t<${tag}/>`).join('\n');
    const hnsSignBlock = `\t<hns_sign>\n\t\t<hamnosys_nonmanual/>\n\t\t<hamnosys_manual>\n${manualTags}\n\t\t</hamnosys_manual>\n\t</hns_sign>`;
    sigmlBlocks.push(hnsSignBlock);
  }

  const header = '<?xml version="1.0" encoding="UTF-8"?>\n<sigml>\n';
  const footer = '\n</sigml>';
  const body = sigmlBlocks.join('\n');

  return header + body + footer;
}
</script>

</head>

<body onload="CWASA.init({avSettings:{initCamera:[0.00,0.53,2.06,-12.50,18.00,30.00,-1.00,-1.00],initSpeed:-1},useClientConfig:true});">

<!-- CWA signing avatar panel 0 -->
<div class="CWASAPanel av0" align="center" ></div>

<!-- New section for HamNoSys input -->
<div align="center">
  <br>
  New HamNoSys: <input type="button" value="doHamNoSys" onclick='playHamNoSys();' /><br>
  <textarea id="myHamNoSys" class="txtaSiGMLText" rows="6" ></textarea>
</div>
<hr/>
<div align="center">
  <br>
  Generated SiGML:
  <textarea id="sigmlOutput" class="txtaSiGMLText"></textarea>
</div>
<hr/>
<p>
<small>
Available under the
<a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA License</a>. JRWG 2021-01-19
</small>
</p>
</body>
</html>
